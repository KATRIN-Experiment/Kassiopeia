/*
 * KRampedElectric2Field.hh
 *
 *  Created on: 16 Jun 2016
 *      Author: wolfgang
 */
#ifndef KRAMPEDELECTRIC2FIELD_HH_
#define KRAMPEDELECTRIC2FIELD_HH_

#include "KElectricField.hh"
#include "KField.h"

#include <vector>

namespace KEMField
{

class KRampedElectric2Field : public KElectricField
{
  public:
    typedef enum
    {
        rtLinear,            // simple linear ramping
        rtExponential,       // exponential ramping with given time constant
        rtSinus,             // simple sinus ramping
        rtSquare,            // simple square ramping
        rtFocus,             // quadratically rising potential for time focusing
        rtFocusExperimental  // data driven ramping
    } eRampingType;

  public:
    KRampedElectric2Field();
    ~KRampedElectric2Field() override;

  private:
    double PotentialCore(const KPosition& aSamplePoint, const double& aSampleTime) const override;
    KThreeVector ElectricFieldCore(const KPosition& aSamplePoint, const double& aSampleTime) const override;
    double CalculateNeededPotential(const double& aTof, const bool small) const;

  public:
    double GetModulationFactor(const double& aTime) const;

  private:
    void InitializeCore() override;

    const std::vector<double> tof_mc = {
        1.74097798e-05, 1.64689266e-05, 1.52162139e-05, 1.44362827e-05, 1.38436714e-05, 1.29823529e-05, 1.28847160e-05,
        1.20163020e-05, 1.15525911e-05, 1.12001047e-05, 1.10430790e-05, 1.05898944e-05, 1.03365721e-05, 1.01686915e-05,
        1.00426751e-05, 9.90380022e-06, 9.53858217e-06, 9.46165799e-06, 9.27770666e-06, 8.99239996e-06, 8.78434275e-06,
        8.75861585e-06, 8.53879215e-06, 8.51013046e-06, 8.43017861e-06, 8.18201945e-06, 8.18362843e-06, 8.14987423e-06,
        7.77648827e-06, 7.77623467e-06, 7.80640070e-06, 7.51512832e-06, 7.48521780e-06, 7.39399574e-06, 7.25871079e-06,
        7.10176734e-06, 7.09972970e-06, 7.02679585e-06, 6.92889778e-06, 6.90273406e-06, 6.80828655e-06, 6.68333128e-06,
        6.66062433e-06, 6.61318950e-06, 6.55276335e-06, 6.41186604e-06, 6.32198091e-06, 6.30755825e-06, 6.23281021e-06,
        6.19070174e-06, 6.10810023e-06, 6.04434575e-06, 6.01051893e-06, 5.96143197e-06, 5.86485919e-06, 5.84179074e-06,
        5.80540470e-06, 5.76722384e-06, 5.69817088e-06, 5.65551328e-06, 5.56849538e-06, 5.57782460e-06, 5.52297492e-06,
        5.42326421e-06, 5.36383015e-06, 5.32155103e-06, 5.29426194e-06, 5.25523110e-06, 5.18124939e-06, 5.16075092e-06,
        5.10386100e-06, 5.08037177e-06, 5.02952992e-06, 4.96915653e-06, 4.94147425e-06, 4.91795221e-06, 4.87508882e-06,
        4.84567962e-06, 4.81905398e-06, 4.74793971e-06, 4.71578180e-06, 4.66601413e-06, 4.64477426e-06, 4.62201913e-06,
        4.59535088e-06, 4.53440694e-06, 4.50731917e-06, 4.45184567e-06, 4.41644790e-06, 4.37957567e-06, 4.36155929e-06,
        4.32053739e-06, 4.29116186e-06, 4.24104129e-06, 4.20835690e-06, 4.18733228e-06, 4.14851459e-06, 4.13124778e-06,
        4.10314234e-06, 4.05186635e-06, 4.02005939e-06, 3.98866282e-06, 3.96054867e-06, 3.94773327e-06, 3.90262013e-06,
        3.87810216e-06, 3.84791697e-06, 3.82196587e-06, 3.77801514e-06, 3.75212993e-06, 3.72067686e-06, 3.69912545e-06,
        3.67081023e-06, 3.64768648e-06, 3.60871978e-06, 3.57974242e-06, 3.56183040e-06, 3.52276993e-06, 3.50180782e-06,
        3.47237097e-06, 3.44476680e-06, 3.41741619e-06, 3.38842167e-06, 3.36467345e-06, 3.34568077e-06, 3.30380976e-06,
        3.28601775e-06, 3.26247120e-06, 3.23704953e-06, 3.20047407e-06, 3.18002700e-06, 3.16199940e-06, 3.13476061e-06,
        3.09974505e-06, 3.08044679e-06, 3.05901158e-06, 3.03203197e-06, 3.00762883e-06, 2.97521982e-06, 2.95731660e-06,
        2.93346359e-06, 2.90688586e-06, 2.87701825e-06, 2.85369295e-06, 2.83467134e-06, 2.80421056e-06, 2.78718210e-06,
        2.76191197e-06, 2.73254166e-06, 2.71603761e-06, 2.69419494e-06, 2.67143558e-06, 2.64811672e-06, 2.62813225e-06,
        2.60806669e-06, 2.58766524e-06, 2.58422147e-06};

    const std::vector<double> u_mc = {
        0.2964804,    0.5962858,    0.89946611,   1.20607216,   1.51615578,   1.82976974,   2.14696784,   2.46780491,
        2.79233682,   3.12062052,   3.45271408,   3.78867667,   4.12856862,   4.47245146,   4.82038791,   5.17244192,
        5.52867874,   5.88916488,   6.25396819,   6.62315789,   6.99680459,   7.37498032,   7.75775856,   8.14521431,
        8.5374241,    8.93446601,   9.33641975,   9.74336668,   10.15538984,  10.57257401,  10.99500575,  11.42277344,
        11.85596733,  12.29467958,  12.73900431,  13.18903768,  13.6448779,   14.1066253,   14.57438238,  15.04825391,
        15.52834689,  16.01477074,  16.50763724,  17.00706069,  17.51315789,  18.02604831,  18.54585406,  19.07270001,
        19.60671389,  20.14802632,  20.6967709,   21.25308431,  21.81710641,  22.38898026,  22.9688523,   23.55687235,
        24.15319381,  24.75797367,  25.37137265,  25.99355532,  26.62469019,  27.26494983,  27.91451099,  28.57355473,
        29.24226651,  29.92083637,  30.60945903,  31.30833406,  32.01766599,  32.73766447,  33.46854445,  34.21052632,
        34.96383605,  35.72870542,  36.50537216,  37.29408014,  38.09507956,  38.90862716,  39.73498642,  40.57442776,
        41.42722879,  42.2936745,   43.17405755,  44.06867846,  44.97784591,  45.90187699,  46.84109747,  47.7958421,
        48.7664549,   49.75328947,  50.75670933,  51.77708822,  52.81481047,  53.87027138,  54.94387755,  56.03604731,
        57.14721112,  58.27781198,  59.42830588,  60.59916227,  61.79086452,  63.00391045,  64.23881279,  65.49609981,
        66.77631579,  68.08002168,  69.40779569,  70.76023392,  72.13795104,  73.541581,    74.97177774,  76.42921597,
        77.91459192,  79.42862426,  80.97205488,  82.54564984,  84.15020033,  85.78652364,  87.45546421,  89.15789474,
        90.89471728,  92.6668645,   94.47530086,  96.32102399,  98.20506602,  100.12849507, 102.09241669, 104.09797555,
        106.14635701, 108.23878894, 110.37654352, 112.56093921, 114.79334275, 117.0751713,  119.40789474, 121.79303795,
        124.2321834,  126.72697368, 129.27911436, 131.89037683, 134.56260141, 137.29770058, 140.09766243, 142.96455424,
        145.90052632, 148.90781601, 151.988752,   155.14575878, 158.38136146, 161.69819079, 165.09898851, 168.58661304,
        172.16404547, 175.83439593, 179.60091036, 183.46697769, 187.43613748};

    const std::vector<double> tof_mc_small = {
        1.1743992808819164e-05, 9.139118011686965e-06,  8.479133775836913e-06,  8.120570198977171e-06,
        7.138389473894854e-06,  6.372615755861031e-06,  5.525545661053933e-06,  5.273792470615123e-06,
        5.194660733887406e-06,  4.925251626884404e-06,  5.0043959350610695e-06, 4.89889574900174e-06,
        4.649423454194526e-06,  4.019913938989866e-06,  3.9147932989250695e-06, 3.7493332476694705e-06,
        3.622976736524535e-06,  3.456885119716217e-06,  3.461839913190217e-06,  3.4713881514114715e-06,
        3.3417401180289835e-06, 3.242996051346547e-06,  3.2354054576154556e-06, 3.1426676048024386e-06,
        3.1342464913686247e-06, 3.306614849363107e-06,  3.1573418132292145e-06, 2.9232459099937473e-06,
        2.762506439474475e-06,  2.711051068261369e-06,  2.7300298169156315e-06, 2.649318307636758e-06,
        2.5847750647547423e-06, 2.587163055726832e-06,  2.485655758170302e-06,  2.4689886287395917e-06,
        2.4666860309169326e-06, 2.414493853338456e-06,  2.391600000189775e-06,  2.4175006687353466e-06,
        2.2795819563620968e-06, 2.197025843245865e-06,  2.1799078428774583e-06, 2.1799078428774583e-06,
        2.223162732666634e-06,  2.2109307493302216e-06, 2.1581990227256417e-06, 2.1147445093374167e-06,
        2.0848350459059685e-06, 2.01930127066911e-06,   2.045400918836703e-06,  1.9797239984229743e-06,
        1.9828340735638094e-06, 1.9562659987198432e-06, 1.892450373682346e-06,  1.8741981458617744e-06,
        1.8510419793552163e-06, 1.8217743948933662e-06, 1.7989860122119657e-06, 1.796355274235142e-06,
        1.7622845089265575e-06, 1.7344075179752626e-06, 1.7322722061543621e-06, 1.7480149026194893e-06,
        1.7092356270190246e-06, 1.6692594814839867e-06, 1.6410327017158982e-06, 1.6519096289603274e-06,
        1.6332256163110843e-06, 1.6138400349553205e-06, 1.5974375260378487e-06, 1.5884146446860415e-06,
        1.5520778225361472e-06, 1.528130692505066e-06,  1.5297547427066865e-06, 1.5208499254713404e-06,
        1.5124218876961167e-06, 1.4936922732802307e-06, 1.4593801597162363e-06, 1.4505323617649458e-06,
        1.4443063982361924e-06, 1.4324227460116206e-06, 1.407072466709602e-06,  1.39039815930526e-06,
        1.384916161352272e-06,  1.3826156301910606e-06, 1.3628831165598232e-06, 1.350232912560421e-06,
        1.3382159528480422e-06, 1.3242181234953918e-06, 1.3145496579528758e-06, 1.3047014433300265e-06,
        1.293516499787583e-06,  1.2559341966669439e-06, 1.2557280789921944e-06, 1.2512923654431195e-06,
        1.2451824227457936e-06, 1.2398097298718769e-06, 1.2236000235036267e-06, 1.204467835525562e-06,
        1.1911509530229408e-06, 1.182827592902877e-06,  1.170856940734235e-06,  1.1617408422825579e-06,
        1.153104740837887e-06,  1.1478593735730565e-06, 1.1398982823147045e-06, 1.1248849350815808e-06,
        1.111042364961433e-06,  1.0990022947759222e-06, 1.086346075097616e-06,  1.085422885315983e-06,
        1.085991332385986e-06,  1.0752396958140764e-06, 1.0657553086416252e-06, 1.051959833007067e-06,
        1.0415120823937425e-06, 1.0365677324726715e-06, 1.0263514458194383e-06, 1.0160791816776444e-06,
        9.954856292466392e-07,  9.949471576546703e-07,  9.860865597650506e-07,  9.682074871942135e-07,
        9.61345731036502e-07,   9.570431597585926e-07,  9.517846419350348e-07,  9.326138977208233e-07,
        9.260697250707119e-07,  9.226037000074796e-07,  9.143350221237893e-07,  9.075267640787672e-07,
        8.967383093871342e-07,  8.893464573973193e-07,  8.806984165947957e-07,  8.688995892393478e-07,
        8.650281051362469e-07,  8.587847416250076e-07,  8.431200832919563e-07,  8.37513393737698e-07,
        8.307451191431693e-07,  8.267208584301255e-07,  8.130983637380678e-07,  8.062253376010835e-07,
        7.981063011986933e-07,  7.929323556201088e-07,  7.846102510710664e-07,  7.797850962437014e-07,
        7.669542064526808e-07,  7.629485407736318e-07,  7.541640747572851e-07,  7.472480061496771e-07,
        7.389795421380016e-07,  7.300046351270977e-07,  7.21985533820403e-07,   7.156659183260228e-07,
        7.077270579957155e-07};

    const std::vector<double> u_mc_small = {
        0.29648040271765264, 0.5962858038949026, 0.8994661094093637, 1.2060721649791217, 1.5161557774821477,
        1.8297697368421018,  2.146967838497776,  2.4678049064739804, 2.7923368170724103, 3.120620523201495,
        3.45271407936516,    3.7886766673308427, 4.1285686224979745, 4.472451460988902,  4.820387907484969,
        5.172441923831206,   5.52867873843399,   5.889164876476899,  6.253968190981091,  6.623157894736842,
        6.996804593134748,   7.3749803179254005, 7.757758561937794,  8.145214314787562,  8.537424099607616,
        8.934466010834658,   9.336419753086423,  9.743366681165721,  10.155389841228985, 10.572574013157887,
        10.995005754174658,  11.422773443742818, 11.855967329797002, 12.29467957634679,  12.73900431250149,
        13.189037682964798,  13.644877900049545, 14.106625297265163, 14.574382384532758, 15.048253905084064,
        15.528346894103539,  16.01477073917481,  16.50763724259512,  17.00706068562431,  17.513157894736853,
        18.026048309948983,  18.545854055295475, 19.072700011533584, 19.606713891154858, 20.14802631578947,
        20.6967708960899,    21.253084314185855, 21.817106408804833, 22.388980263157887, 22.968852295693253,
        23.55687235382543,   24.153193810751826, 24.757973665473752, 25.371372646143342, 25.99355531686358,
        26.62469018807405,   27.264949830660235, 27.914510993930953, 28.57355472761458,  29.242266508030923,
        29.920836368603155,  30.609459034881237, 31.308334064255828, 32.01766599054998,  32.73766447368421,
        33.46854445461903,   34.21052631578946,  34.96383604725438,  35.7287054187948,   36.50537215820615,
        37.294080136039945,  38.09507955706333,  38.9086271587171,   39.73498641686587,  40.57442775914855,
        41.42722878625135,   42.29367450144147,  43.17405754871607,  44.06867845993754,  44.97784591134519,
        45.90187698985174,   46.841097469554036, 47.79584209890746,  48.76645489903753,  49.75328947368423,
        50.75670933130083,   51.77708821985528,  52.81481047490894,  53.870271381578924, 54.943877551020414,
        56.03604731209712,   57.14721111894641,  58.27781197517863,  59.428305875492015, 60.59916226552539,
        61.79086452081328,   63.003910445757214, 64.23881279357452,  65.49609980823736,  66.77631578947367,
        68.08002168195624,   69.40779568987203,  70.76023391812862,  72.13795104152491,  73.54158100328947,
        74.97177774446794,   76.42921596572751,  77.9145919232338,   79.42862426035502,  80.97205487704696,
        82.54564983888288,   84.15020032780916,  85.78652363682752,  87.45546421094178,  89.15789473684211,
        90.89471728395351,   92.66686449963473,  94.47530086148316,  96.32102398988648,  98.20506602415668,
        100.12849506578945,  102.09241669261911, 104.09797554787583, 106.14635700841055, 108.23878893662726,
        110.3765435209575,   112.56093921002883, 114.79334274601737, 117.07517130304133, 119.4078947368421,
        121.79303795242164,  124.23218339675859, 126.7269736842105,  129.27911436273797, 131.8903768296481,
        134.5626014061654,   137.29770058079765, 140.097662432167,   142.96455424274967, 145.90052631578948,
        148.90781600854365,  151.98875199599232, 155.14575878018078, 158.38136146150498, 161.69819078947364,
        165.09898851181333,  168.5866130422292,  172.1640454687013,  175.83439592590267, 179.60091035717844,
        183.46697769354122,  187.43613747933935};


  public:
    ;
    K_SET_GET_PTR(KElectricField, RootElectricField1);
    K_SET_GET_PTR(KElectricField, RootElectricField2);
    K_SET_GET(eRampingType, RampingType);
    K_SET_GET(int, NumCycles);
    K_SET_GET(double, RampUpDelay);
    K_SET_GET(double, RampDownDelay);
    K_SET_GET(double, RampUpTime);
    K_SET_GET(double, RampDownTime);
    K_SET_GET(double, TimeConstant);
    K_SET_GET(double, TimeScalingFactor);
    K_SET_GET(double, FocusTime);
    K_SET_GET(double, FocusExponent);
    K_SET_GET(bool, Small)
};

} /* namespace KEMField */

#endif /* KRAMPEDELECTRIC2FIELD_HH_ */
